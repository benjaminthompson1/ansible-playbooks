###############################################################################
# Usage:
#  ansible-playbook -i <inventory> <playbook>
#
# Example:
#  ansible-playbook -i inventory base_jobcard.yml
#  ansible-playbook -i inventory base_jobcard.yml -v
###############################################################################
---
- hosts: ben_s0w1 
  collections:
    - ibm.ibm_zos_core
  gather_facts: no

  vars:
    adcd_ver: Z25C

  environment: "{{ environment_vars }}"

  tasks:
    - name: Ping using zos_ping
      zos_ping:
      register: zos_ping_result

    - name: Response from zos_ping
      debug:
        msg: "{{ zos_ping_result }}"

###############################################################################
# Usage:
#  Create member JOBCARD
###############################################################################

    - name: Create member JOBCARD; replace if member exists.
      zos_data_set:
        name: USER.{{ adcd_ver }}.SYSEXEC(JOBCARD)
        type: MEMBER
        replace: yes
      register: zos_data_set_result

    - name: DEBUG(-v) Response from Create member JOBCARD.
      debug:
        msg: "{{ zos_data_set_result }} with verbosity 1"
        verbosity: 1

###############################################################################
# Usage:
#  Add JOBCARD REXX
###############################################################################

    - name: Insert JOBCARD REXX into JOBCARD.
      zos_blockinfile:
        src: USER.{{ adcd_ver }}.SYSEXEC(JOBCARD)
        block: |
          /* REXX */
          /* Insert JOBCARD to JCL in ISPF Edit */
          "ISREDIT MACRO"
          lineno = 0
          line = "//IU***** JOB (FB3),'********',CLASS=A,MSGCLASS=H,"
          "ISREDIT LINE_AFTER "lineno" = (line)"
          lineno = lineno + 1
          line = "//       NOTIFY=&SYSUID,REGION=0M,TIME=1440"
          "ISREDIT LINE_AFTER "lineno" = (line)"
          lineno = lineno + 1
          line = "//*      TYPRUN=HOLD"
          "ISREDIT LINE_AFTER "lineno" = (line)"
          Exit 0
      register: zos_blockinfile_result
      
    - name: DEBUG(-v) Response from Insert JOBCARD REXX into JOBCARD.
      debug:
        msg: "{{ zos_blockinfile_result }} with verbosity 1"
        verbosity: 1

    - name: Remove block header and footer from JOBCARD REXX.
      zos_lineinfile:
        src: USER.{{ adcd_ver }}.SYSEXEC(JOBCARD)
        state: absent
        regexp: '^#'
      register: zos_lineinfile_result

    - name: DEBUG(-v) Response from Remove block header and footer from JOBCARD REXX.
      debug:
        msg: "{{ zos_lineinfile_result }} with verbosity 1"
        verbosity: 1

###############################################################################
# Usage:
#  Alter DBSPROCC SYSEXEC DD to refernece USER.&SYSVER..SYSEXEC
###############################################################################

    - name: Insert new dataset in DBSPROCC SYSEXEC DD.
      zos_lineinfile:
        src: USER.{{ adcd_ver }}.PROCLIB(DBSPROCC)
        insertafter: '^//SYSEXEC'
        line: '//         DD  DISP=SHR,DSN=USER.&SYSVER..SYSEXEC'
      register: zos_lineinfile_result

    - name: DEBUG(-v) Response from Insert new dataset in DBSPROCC SYSEXEC DD.
      debug:
        msg: "{{ zos_lineinfile_result }} with verbosity 1"
        verbosity: 1

###############################################################################
# Usage:
#  Alter DBSPROCD SYSEXEC DD to refernece USER.&SYSVER..SYSEXEC
###############################################################################

    - name: Insert new dataset in DBSPROCD SYSEXEC DD.
      zos_lineinfile:
        src: USER.{{ adcd_ver }}.PROCLIB(DBSPROCD)
        insertafter: '^//SYSEXEC'
        line: '//         DD  DISP=SHR,DSN=USER.&SYSVER..SYSEXEC'
      register: zos_lineinfile_result

    - name: DEBUG(-v) Response from Insert new dataset in DBSPROCD SYSEXEC DD.
      debug:
        msg: "{{ zos_lineinfile_result }} with verbosity 1"
        verbosity: 1


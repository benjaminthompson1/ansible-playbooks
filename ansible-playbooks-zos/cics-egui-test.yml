###############################################################################
# Usage:
#  ansible-playbook -i <inventory> <playbook>
#
# Example:
#  ansible-playbook -i inventory cics_egui.yml
#  ansible-playbook -i inventory cics_egui.yml -v
###############################################################################
---
- hosts: s0w1 
  collections:
    - ibm.ibm_zos_core
  gather_facts: no

  vars:
    adcd_ver: Z24C
    high_level_qualifier: IBMUSER
    cics_high_level_qualifier: DFH560

  environment: "{{ environment_vars }}"

  tasks:
    - name: Ping using zos_ping
      zos_ping:
      register: zos_ping_result

    - name: Response from zos_ping
      debug:
        msg: "{{ zos_ping_result }}"

###############################################################################
# Usage: 
#  Transfer cics-egui-CSD.txt to z/OS LPAR
###############################################################################

    - name: Copy cics-egui-CDS.txt to z/OS LPAR.
      copy: 
        src: cics-egui-CSD.txt
        dest: "/tmp/cics-egui-CSD.txt"
      register: copy_result

    - name: Response from Copy cics-egui-CSD.txt to z/OS LPAR.
      debug:
        msg: "{{ copy_result }}"
        verbosity: 1       

    - name: Community command with ls
      command: ls -la /tmp/cics-egui-CSD.txt
      register: result

    - name: Response
      debug:
        msg: "{{ result }}"

###############################################################################
# Usage: 
#  Convert cics-egui-CSD.txt to IBM-1047 and submit the job
###############################################################################

#    - name: Convert CSD JCL file to IBM-1047 and submit the job.
#      zos_job_submit:
#        src: "/tmp/cics-egui-CSD.txt"
#        location: USS
#        wait: true
#        encoding:
#          from: ISO8859-1
#          to: IBM-1047
#      register: zos_job_submit_result       
#
#    - name: DEBUG(-v) Response from Convert CSD JCL file to IBM-1047 and submit the job.
#      debug:
#        msg: "{{ zos_job_submit_result }} with verbosity 1"
#        verbosity: 1

    - name: Community command with ls
      command: ls -la /tmp/cics-egui-CSD.txt
      register: result

    - name: Response
      debug:
        msg: "{{ result }}"
###############################################################################
# Usage: 
#  Dataset clean-up
###############################################################################

    # - name: Dataset clean-up.
      # zos_tso_command:
           # commands:
               # - delete '{{ high_level_qualifier }}.EXMPCAT.INPUT' 
               # - delete '{{ high_level_qualifier }}.EXMPCONF.INPUT'
               # - delete '{{ high_level_qualifier }}.IDCAMS.OUTPUTD' 
      # ignore_errors: true   
      # register: zos_tso_command_result  

    # - name: DEBUG(-v) Response from Dataset clean-up.
      # debug:
        # msg: "{{ zos_tso_command_result }} with verbosity 1"
        # verbosity: 1   
